<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>capture microphone audio into buffer</title>
    
<audio id="audioCapture"></audio>
<script>
    var audioCapture = (function ()
    {
        var init = function ()
        {
            initCapture();
        };
    
        function initCapture()
        {
            var constraints = { audio: true, video: false };
    
            navigator.mediaDevices.getUserMedia(constraints).then(function (stream)
            {
                var audio = document.getElementById('audioCapture');
                audio.srcObject = stream;
                var context = new AudioContext();
                var srcObject = context.createMediaElementSource(audio);
                var analyser = context.createAnalyser();

                srcObject.connect(analyser);
                analyser.connect(context.destination);

                analyser.fftSize = 256;

                var bufferLength = analyser.frequencyBinCount;

                console.log(bufferLength);

                var dataArray = new Uint8Array(bufferLength);
                
                audio.load();
                audio.play();
                function loop(){

                    analyser.getByteFrequencyData(dataArray);
    
                    console.log(dataArray);
                }
                loop();
            }).catch(function (err)
            {
                console.log(err);
            });
        }
    
        return {
            Init: init
        }
    })();
    audioCapture.Init();
</script>
</head>
<body>

</body>
</html>